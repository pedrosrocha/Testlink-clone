{% extends 'base.jinja2' %}

{% block content %}

<a href="{{url_for('login')}}">Login</a>

<h1>Add new user</h1>

<form id="add-user-form" method="POST">
    <input id="username" name="username" placeholder="Username">
    <span id="username-error" style="color:red; display:none;"></span><br>

    <input id="email" name="email" type="email" placeholder="Email">
    <span id="email-error" style="color:red; display:none;"></span><br>

    <input id="password" name="password" type="password" placeholder="Password">
    <span id="password-error" style="color:red; display:none;"></span><br>

    <input type="submit" value="Add">
</form>

{% with messages = get_flashed_messages() %}
{% for message in messages %}
<p>{{ message }}</p>
{% endfor %}
{% endwith %}

<script>
    document.getElementById('add-user-form').addEventListener('submit', function (e) {
        let isValid = true;

        // Clear previous messages first
        document.querySelectorAll('span[id$="-error"]').forEach(el => {
            el.style.display = 'none';
            el.textContent = '';
        });

        // Validate fields
        if (document.getElementById('username').value.trim() === '') {
            document.getElementById('username-error').textContent = "Username cannot be empty.";
            document.getElementById('username-error').style.display = "inline";
            isValid = false;
        }
        if (document.getElementById('email').value.trim() === '') {
            document.getElementById('email-error').textContent = "Email cannot be empty.";
            document.getElementById('email-error').style.display = "inline";
            isValid = false;
        }

        if (document.getElementById('password').value.length < 6) {
            document.getElementById('password-error').textContent = "Password must have at least 6 characters"
            document.getElementById('password-error').style.display = 'inline'
            isValid = false;
        }

        if (!isValid) {
            e.preventDefault();
        }
    });
</script>

{% endblock %}